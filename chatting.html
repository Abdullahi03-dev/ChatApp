<!DOCTYPE html>
<html>
<head>
	 <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="style2.css">
	<title></title>
</head>
<body id="bg">
	<div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->
	<section class="section1">
		
		<aside>
			<h2>USERS</h2>
			<div class="users_list">
				
			</div>
			
		</aside>




<div class="navbar">
	<span>
		<img src="img/closebtn.png" id="closebtn">
	</span>
	<a href="#" id="logout">LOGOUT</a>
	<div class="layer_1">
    <div class="dropDown">
    <h3 id="ques_show">THEMES<img src="img/2722987.png" style="height:20px;"></img></h3>
    <div class="dropDown1" id="dropDown2">
      <a href="" id="links_2" name="#191a22">VULKAN</a>
      <a href="" id="links_2" name="#15171C">DEEP SPACE</a>
      <a href="" id="links_2" name="#121415">DARK SLATE</a>
    </div>
  </div>
  </div>

</div>



		<main>
			<nav>
				<h2><pre></pre>CODE<></></h2>
				<img src="img/2311524.png" id="navbar">
			</nav>
			<div class="chats_display">
				

				<!-- <div class="sent_chats">
					<h6 class="user">Abdullahi</h6>
					<h3>hi</h3>
					<h6 class="time">12:23</h6>
				</div>
				<div class="sent_chats">
					<h6 class="user">Abdullahi</h6>
					<h3>HELLO GUYS WELCOMES</h3>
					<h6 class="time">12:23</h6>
				</div>

<div class="recieve_chats">
	<h6 class="user">Abdullahi</h6>
					<h3>hello</h3>
					<h6 class="time">12:23</h6>
				</div> -->
				<!-- 
				
				<div class="sent_chats">
					<h3>how are you doing bro</h3>
				</div>
				<div class="sent_chats">
					<h3>am fine so this app is workin</h3>
				</div>
				<div class="recieve_chats">
					<h3>is is working oo,thank God</h3>
				</div>
				<div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div><div class="sent_chats">
					<h3>SO WHAT IS POPPING</h3>
				</div> -->
			</div>
			<div class="bottom_input">
					<input type="text" name="" id="input">
					<img src="img/1477153.png" id="send_btn">
			</div>
		</main>
	</section>

<script src="index.js"></script>
<script type="module">

	// Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, onValue,push,get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCG8InYb_aOTFIxdQ6IhGXfYG09a2xQGPg",
  authDomain: "chatapp-852ea.firebaseapp.com",
  databaseURL: "https://chatapp-852ea-default-rtdb.firebaseio.com",
  projectId: "chatapp-852ea",
  storageBucket: "chatapp-852ea.firebasestorage.app",
  messagingSenderId: "987013807085",
  appId: "1:987013807085:web:f5ee18b23d6fe30d8d05e4",
  measurementId: "G-NGN089EERQ"
};
let loader_page=document.querySelector('.js-preloader');
// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOM Elements
const container = document.querySelector(".chats_display");
// const container2 = document.getElementById("container2");

// Reference to the messages in the database
const messagesRef = ref(db, "messages");

// Listen for each child added in the database
onValue(messagesRef, (snapshot) => {
  const messages = snapshot.val();

  for (let key in messages) {
    const messageData = messages[key];
    const messageElement = document.createElement("h3");
    const sendertag = document.createElement("h6");
    sendertag.className='user';
   const timetag=document.createElement("h6");
    const timetag2=document.createElement("h6")
    timetag.className='time';
    timetag2.className="time2"
    messageElement.textContent = `${messageData.message}`;
    sendertag.textContent=`${messageData.name}`
    timetag.textContent=`${messageData.time}`
timetag2.textContent=`${messageData.time}`

    if (messageData.name === localStorage.getItem('chat_name')) {
      const sent_chats=document.createElement('div')
      sent_chats.className='sent_chats';
      sent_chats.appendChild(sendertag)
      sent_chats.appendChild(timetag)
      sent_chats.appendChild(messageElement)
      container.appendChild(sent_chats);
    } else {
      const receive_chats=document.createElement('div')
      receive_chats.className='recieve_chats';
      receive_chats.appendChild(sendertag)
      receive_chats.appendChild(timetag2)
    receive_chats.appendChild(messageElement)
      container.appendChild(receive_chats);
    }
  }

chats_display.scrollTop=chats_display.scrollHeight
loader_page.classList.add('remove_loader')
});



let asideUsers=document.querySelector('.users_list')
let sendbtn=document.getElementById('send_btn')
let input=document.getElementById('input')
let chats_display=document.querySelector('.chats_display')
sendbtn.addEventListener('click',()=>{
	if(input.value==""){
		return
	}
container.innerHTML=''
let date=new Date()
let hour=date.getHours()
let minute=date.getMinutes()
const ampm=hour>=12?'pm':'am';
const time=`${hour%12||12}:${minute.toString().padStart(2,'0')} ${ampm}`
	const dbref=ref(db,'messages');
	push(dbref,{
		name: localStorage.getItem('chat_name'),
		message:input.value,
		time:time,
	})
	input.value=''
	chats_display.scrollTop=chats_display.scrollHeight
})


	const dbref=ref(db,'Users');
async function showUsers(){
	try{
		const snapshot=await get(dbref)
		if (snapshot.exists()) {
			let usersDiv=document.createElement('div')
			// let usersh4=document.createElement('h4')
			const users=snapshot.val();
			const names=Object.values(users).map(user=>{
				usersDiv.innerHTML=`<h4>${user.name}</h4>`
			});
			asideUsers.appendChild(usersDiv)
		}else{
			console.log('no data')
		}
	}catch(err){
		console.log(err)
	}
}
showUsers()








document.getElementById('logout').addEventListener('click',(e)=>{
	e.preventDefault();

	localStorage.removeItem('chat_name');
	if (localStorage.removeItem('chat_name')) {
		window.location='register/login.html'
	}
})
 let dropDown2=document.querySelector('#dropDown2')
    let time_show2=document.querySelector('#ques_show')
    let links2=document.querySelectorAll('#links_2')
    time_show2.addEventListener('click',(e)=>{
      dropDown2.classList.toggle('drop_show')
    })
let click2=false
    links2.forEach((link2)=>{
      link2.addEventListener('click',(f)=>{
        f.preventDefault()
      time_show2.innerHTML=link2.innerHTML+'<img src="img/2722987.png" style="20px;height:20px;"></img>'
       dropDown2.classList.remove('drop_show')



      })
    })
    let bg=document.getElementById('bg')
    function bgToggler() {
      links2.forEach((link2)=>{
      link2.addEventListener('click',(f)=>{
        f.preventDefault()
        let color=link2.name;
        bg.style.backgroundColor=color
        localStorage.setItem('themes',color)
      })
    })
    }
bgToggler()

window.onload=()=>{
  let gottenColor=localStorage.getItem('themes')
  bg.style.backgroundColor=gottenColor
}

</script>
</body>
</html>
